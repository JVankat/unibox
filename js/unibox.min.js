var UniBox=function(){var B=-1;var u;var e;var i;var f="";var p="";var G=-80;var I;var a;var l=[];var P=true;var r;var g;var s=300;var o="";var m=2;var x;var v;var N;var d;var c;var D;var O=[];var t="all";var C=-1;var A="";var b=false;var M=[];var j=[];var w=undefined;var R=undefined;var S=undefined;var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function L(U){U=U||window.event;if(U!==undefined){var V=U.keyCode||U.which;var W=u.val();if(V==27||V==13||V==9||W.length<m){z(U);if(V==13&&x!==undefined&&B==-1){x.call(this,W)}B=-1}}else{z(U);B=-1}}function z(U){if(c!==undefined){c.call(this,U,i.val())}i.removeClass("uniboxActive");i.slideUp(s);q()}function H(V,U){var W=null;return function(){var Y=this,X=arguments;clearTimeout(W);W=window.setTimeout(function(){V.apply(Y,X)},U||50)}}function J(V,U){if(!P){return V}var ab=U.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/[^a-zA-Z0-9äöüÄÖÜß]/g," ").split(" ");ab.sort(function(ad,ac){return ac.length-ad.length});var aa={};jQuery.each(ab,function(ac,ah){if(ah.length<1){return}var ag=V.match(new RegExp("(("+ah+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(ag!=null){for(var af=0;af<ag.length;af++){var ae=ag[af];var ad=ae.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");V=V.replace(new RegExp("("+ad+")(?!#<##|-\\d+#<##)","g"),"##>#"+ac+"-"+af+"#<##");aa["##>#"+ac+"-"+af+"#<##"]='<span class="unibox-highlight">'+ae+"</span>"}}});var Y=Object.keys(aa).reverse();for(var W=0;W<Y.length;W++){var Z=Y[W];var X=aa[Z];V=V.replace(new RegExp(Z,"gi"),X)}return V}function Q(U){return U.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function y(U){return String(U).replace(/[&<>"'\/]/g,function(V){return n[V]})}function T(Y){if(C==13){L();return}var U=u.val();var Z=y(U);i.html("");var W=false;var X=Object.keys(Y.suggests);if(M&&M.length>0){X=M;jQuery.each(Object.keys(Y.suggests),function(aa,ab){if(jQuery.inArray(ab,X)<0){X.push(ab)}})}jQuery.each(X,function(aa,ad){var ac=Y.suggests[ad];if(!ac||ac.length==0){return true}var ab=0;jQuery.each(X,function(ag,ai){var ah=Y.suggests[ai];if(!ah||ad===ai||ah.length==0){return true}ab+=ah.length});var af=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+Q(ad)+" "+("unibox-"+ac.length+"-entries")+" "+(ab==0?"unibox-single-suggestion-block":"")+'"></div>');if(ad.replace(/_/,"").length>0&&ac.length>0){var ae=jQuery("<h4>"+ad+"</h4>");af.append(ae)}jQuery.each(ac,function(ap,an){var ak='<div class="unibox-selectable">';if(an.image!=undefined){var ar=an.image.length===0&&I?I:an.image.length===0||an.image.indexOf("/")===0||an.image.indexOf("http")===0?an.image:p+an.image;ak+='<div class="unibox-selectable-img-container"><img src="'+ar+'"/></div>'}if(an.link!=undefined&&an.link!=""){ak+='<a class="uniboxSearchContent" href="'+an.link+'">';ak+=J(an.name,Z);ak+="</a>"}else{ak+='<span class="uniboxSearchContent">'+J(an.name,Z)+"</span>"}if(r!=undefined){var ao=r.match(/##(.*?)##/gi);var aj=r;var ai=false;for(var al=0;al<ao.length;al++){var am=ao[al];if(am===undefined||am.length==0){continue}var ah=am.replace(/#/g,"");var ag=an[ah];if(ag==undefined){ai=true;continue}var at=new RegExp(am,"g");aj=aj.replace(at,ag)}if(!ai){ak+='<div class="unibox-extra">'+aj+"</div>"}}ak+='<div class="unibox-ca"></div></div>';if(g!==undefined){ak=g.call(this,ak,ad,ap,an)}var aq=jQuery(ak);af.append(aq);W=true});i.append(af)});l=e.find(".unibox-selectable");if(j&&j.length>0){l=[];jQuery.each(j,function(aa,ab){l=l.concat(e.find(".unibox-suggest-"+Q(ab)+":first .unibox-selectable").get())});jQuery.each(jQuery.grep(Object.keys(Y.suggests),function(aa){if(j.indexOf(aa)<0){return true}}),function(aa,ab){l=l.concat(e.find(".unibox-suggest-"+Q(ab)+":first .unibox-selectable").get())})}B=-1;jQuery(l).mousedown(function(){var ab=jQuery(this).find(".uniboxSearchContent:first").text();u.val(ab);var aa=undefined;try{aa=jQuery(this).find("a:first").attr("href")}catch(ac){}if(v!=undefined){v.call(this,ab,aa)}L()});e.find(".unibox-selectable .unibox-extra").click(function(aa){aa.stopPropagation()});if(Y.words!=undefined){if(Y.words.length>0&&o.length>0&&(t=="all"||t=="bottom")){i.append("<h4>"+o+"</h4>");W=true}var V=[];jQuery.each(Y.words,function(ab,ae){if((t=="all"||t=="bottom")){if(ae.overlayImage!=undefined){i.append('<img class="unibox-vis" src="'+p+ae.overlayImage+'" style="background-image: url(\''+p+ae.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(ae.image!=undefined){i.append('<img class="unibox-vis" src="'+p+ae.image+'">')}}}var ad=e.find("#unibox-invisible");ad.css("padding",u.css("padding"));ad.html(Z.replace(new RegExp(ae.name,"gi"),"<span>"+ae.name+"</span>"));if((t=="all"||t=="top")&&jQuery.inArray(ae.image,O)==-1){var ac=e.find("#unibox-invisible span")[0];if(ac!=undefined&&ae.name.length>0&&ae.image!=undefined){var aa=jQuery(ac).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+p+ae.image+'" alt="'+ae.name+'"></div>');visImage.css("left",k().left+aa-10);visImage.css("top",k().top-u.outerHeight()+G);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);V.push(ae.image)}}else{if(jQuery.inArray(ae.image,O)>-1){V.push(ae.image)}}});O=V}jQuery("img").on("error",function(){if(I){jQuery(this).attr("src",I)}else{jQuery(this).hide()}});h();if(R!=undefined&&!W){W=true;i.append(R)}if(W){if(i.is(":visible")){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)}else{i.slideDown(s,function(){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)})}}else{L()}}function k(){return{left:u.offset().left-e.offset().left,top:u.offset().top-e.offset().top+u.outerHeight()}}function F(){var V=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var U=0;U<V.length;U++){if(jQuery.inArray(V[U].replace(p,""),O)==-1){e.find('.unibox-ivf:has(img[src*="'+V[U]+'"])').remove()}}}function q(){O=[];e.find(".unibox-ivf").remove()}function K(U){if(u.val().length<=1){q()}if(N!=undefined){N.call(this,U,u.val())}if(U.keyCode!=37&&U.keyCode!=38&&U.keyCode!=39&&U.keyCode!=40&&U.keyCode!=13){F();return}if(U.keyCode==38&&B>0){B--}else{if(U.keyCode==40){B++}else{if(U.keyCode==38&&B<=0){B=((B!=-1)?B-1:B)+l.length}else{if((U.keyCode==37||U.keyCode==39)&&B>-1){B=B%l.length;var Y=jQuery(l[B]);var ab=Y.closest(".unibox-suggest-cluster");var W;if(U.keyCode==37){W=ab.prev()}else{if(U.keyCode==39){W=ab.next()}}if(W.hasClass("unibox-suggest-cluster")){var ac=W.find("div.unibox-selectable")[0];B=jQuery("#unibox-suggest-box div.unibox-selectable").index(ac)}}}}}if(l.length>0&&B>-1){B=B%l.length;jQuery(l).removeClass("active");var Z=jQuery(l[B]);Z.addClass("active")}if(U.keyCode==13){U.preventDefault();U.stopPropagation();if(v!=undefined){var X=u.val();var V=undefined;if(B!=-1){X=e.find(".unibox-selectable.active .uniboxSearchContent:first").text();u.val(X);try{V=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(aa){}if(v!=undefined){v.call(this,X,V)}}}else{if(B!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(B>-1){U.preventDefault()}}function E(U){if(C==18){C=U.keyCode;return}C=U.keyCode;if(((U.keyCode==37||U.keyCode==39)&&B>-1)||U.keyCode==38||U.keyCode==40||U.keyCode==13||U.keyCode==9){return}var V=u.val();if(C==46&&V.length==0){q()}if(V.length>=m){A=V;jQuery.ajax({usedQuery:V,url:f+encodeURIComponent(V),dataType:"json",success:function(W){if(this.usedQuery==A){T(W)}}})}}function h(){var V=jQuery("#unibox-suggest-box");var U=V.css("border-width").replace("px","");V.css("min-width",u.outerWidth()-2*U);if(w==undefined){V.css("max-width",u.outerWidth()-2*U)}else{V.css("max-width",w-2*U)}V.css("left",k().left);V.css("top",k().top)}return{updateSuggests:function(U){T(U)},updateSuggestUrl:function(U){f=U},hideSuggestBox:function(){L()},setIvfImagePath:function(U){p=U;if(p.charAt(p.length-1)!="/"){p+="/"}},changeInstantVisualFeedbackState:function(U){t=U},render:function(){h()},getText:function(){return u.val()},init:function(ah,aj){u=ah;e=aj.searchBoxContainer;P=aj.highlight;r=aj.extraHtml;g=aj.lineCallback;f=aj.suggestUrl;p=aj.ivfImagePath;G=aj.ivfImageOffset;I=aj.missingErrorImage;a=aj.throttleTime;s=aj.animationSpeed;m=aj.minChars;x=aj.enterCallback;v=aj.enterCallbackResult;N=aj.typeCallback;d=aj.focusCallback;c=aj.blurCallback;D=aj.placeholder;t=aj.instantVisualFeedback;o=aj.queryVisualizationHeadline;b=aj.showDeleteAllButton;M=aj.suggestOrder;j=aj.suggestSelectionOrder;w=aj.maxWidth;R=aj.noSuggests;S=aj.emptyQuerySuggests;u.attr("autocomplete","off");i=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(i);var af=e.css("position");if(af!="absolute"){e.css("position","relative")}var aa=i.css("border-width").replace("px","");i.css("min-width",u.outerWidth()-2*aa);i.css("max-width",aj.maxWidth-2*aa);u.keydown(K);u.keydown(H(E,a));u.keyup(L);u.focus(function(ak){ak=ak||window.event;ak.stopPropagation();if(jQuery(this).val().length>0){E({keyCode:-1})}else{if(S!=undefined){T(S)}}if(d!==undefined){d.call(this,ak,jQuery(this).val())}});i.mouseenter(function(){i.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(ak){if(i.hasClass("uniboxActive")){z(ak)}});u.keydown(function(al){al=al||window.event;var ak=al.keyCode||al.which;if(ak==9){z(al)}});u.focusout(function(ak){ak=ak||window.event;setTimeout(function(){if(jQuery(document.activeElement).parents("#unibox-suggest-box").length===0){z(ak)}},10)});u.click(function(ak){ak.stopPropagation()});i.click(function(ak){ak.stopPropagation()});var V=u.attr("placeholder");D=V&&V.length>0?V:D;if(D&&D.length>0){var ac=document.createElement("input");if(!("placeholder" in ac)){u.focus(function(){var ak=jQuery(this).attr("placeholder");if((ak)&&(ak.length>0)&&(ak!="")&&jQuery(this).val()==ak){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var ak=jQuery(this).attr("placeholder");if((ak)&&(ak.length>0)&&(ak!="")&&(jQuery(this).val()==""||jQuery(this).val()==ak)){jQuery(this).val(ak).addClass("hasPlaceholder")}});u.val(D)}u.attr("placeholder",D)}var ai=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(ai);if(b){var ag=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(ag);jQuery(ag).mousedown(function(ak){(ak||window.event).stopPropagation();u.val("");u.focus();return false});u.focus(function(){if(u.val().length>0){ag.show()}else{ag.hide()}}).blur(function(){ag.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(ag).show()}});var ae=parseInt(u.css("paddingTop").replace("px","").trim());var ad=u.outerHeight();var ab=parseInt(u.css("borderTopWidth").replace("px","").trim());var Y=u.css("boxShadow").match(/\d{1,3}px/g);var X=(Y&&Y.length>2)?parseInt(Y[2].replace("px","").trim()):0;ag.height(ad-(2*ab)-X-ae);var U=parseInt(u.css("paddingRight").replace("px","").trim());U=(U>25)?U:25;u.css("paddingRight",U);var Z=ab+X+(u.offset().top-u.parent().offset().top-u.parent().scrollTop());var W=Math.abs(u[0].getBoundingClientRect().left-u.parent()[0].getBoundingClientRect().left)+u.outerWidth()-ag.outerWidth()-ab-U;ag.css("top",Z);ag.css("left",W)}if(t=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,lineCallback:undefined,noSuggests:undefined,emptyQuerySuggests:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));