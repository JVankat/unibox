var UniBox=function(){var A=-1;var t;var e;var h;var f="";var o="";var F=-80;var H;var a;var k=[];var O=true;var q;var r=300;var n="";var l=2;var w;var u;var M;var d;var c;var C;var N=[];var s="all";var B=-1;var z="";var b=false;var L=[];var i=[];var v=undefined;var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function K(R){if(R!==undefined){var S=t.val();if(R.keyCode==9||R.keyCode==27||R.keyCode==13||S.length<l){y();if(R.keyCode==13&&w!=undefined&&A==-1){w.call(this,S)}A=-1}}else{y();A=-1}}function y(){h.removeClass("uniboxActive");h.slideUp(r)}function G(S,R){var T=null;return function(){var V=this,U=arguments;clearTimeout(T);T=window.setTimeout(function(){S.apply(V,U)},R||50)}}function I(S,R){if(!O){return S}var Y=R.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/\W+/g," ").split(" ");Y.sort(function(aa,Z){return Z.length-aa.length});var X={};jQuery.each(Y,function(Z,ae){if(ae.length<1){return}var ad=S.match(new RegExp("(("+ae+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(ad!=null){for(var ac=0;ac<ad.length;ac++){var ab=ad[ac];var aa=ab.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");S=S.replace(new RegExp("("+aa+")(?!#<##|-\\d+#<##)","g"),"##>#"+Z+"-"+ac+"#<##");X["##>#"+Z+"-"+ac+"#<##"]='<span class="unibox-highlight">'+ab+"</span>"}}});var V=Object.keys(X).reverse();for(var T=0;T<V.length;T++){var W=V[T];var U=X[W];S=S.replace(new RegExp(W,"gi"),U)}return S}function P(R){return R.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function x(R){return String(R).replace(/[&<>"'\/]/g,function(S){return m[S]})}function Q(V){if(B==13){K();return}var R=t.val();var W=x(R);h.html("");var T=false;var U=Object.keys(V.suggests);if(L&&L.length>0){U=L;jQuery.each(Object.keys(V.suggests),function(X,Y){if(jQuery.inArray(Y,U)<0){U.push(Y)}})}jQuery.each(U,function(X,aa){var Z=V.suggests[aa];if(!Z||Z.length==0){return true}var Y=0;jQuery.each(U,function(ad,af){var ae=V.suggests[af];if(!ae||aa===af||ae.length==0){return true}Y+=ae.length});var ac=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+P(aa)+" "+("unibox-"+Z.length+"-entries")+" "+(Y==0?"unibox-single-suggestion-block":"")+'"></div>');if(aa.replace(/_/,"").length>0&&Z.length>0){var ab=jQuery("<h4>"+aa+"</h4>");ac.append(ab)}jQuery.each(Z,function(al,aj){var ai='<div class="unibox-selectable">';if(aj.image!=undefined){var an=aj.image.length===0&&H?H:aj.image.length===0||aj.image.indexOf("/")===0||aj.image.indexOf("http")===0?aj.image:o+aj.image;ai+='<div class="unibox-selectable-img-container"><img src="'+an+'"/></div>'}if(aj.link!=undefined){ai+='<a href="'+aj.link+'">';ai+=I(aj.name,W);ai+="</a>"}else{ai+="<span>"+I(aj.name,W)+"</span>"}if(q!=undefined){var ak=q.match(/##(.*?)##/gi);var ah=q;var ag=false;for(var ae in ak){var af=ak[ae].replace(/#/g,"");var ad=aj[af];if(ad==undefined){ag=true;continue}var ao=new RegExp(ak[ae],"g");ah=ah.replace(ao,ad)}if(!ag){ai+='<div class="unibox-extra">'+ah+"</div>"}}ai+='<div class="unibox-ca"></div></div>';var am=jQuery(ai);ac.append(am);T=true});h.append(ac)});if(i&&i.length>0){k=[];jQuery.each(i,function(X,Y){k=k.concat(e.find(".unibox-suggest-"+P(Y)+":first .unibox-selectable").get())})}else{k=e.find(".unibox-selectable")}A=-1;jQuery(k).mousedown(function(){var Y=jQuery(this).text();t.val(Y);var X=undefined;try{X=jQuery(this).find("a:first").attr("href")}catch(Z){}if(u!=undefined){u.call(this,Y,X)}K()});e.find(".unibox-selectable .unibox-extra").click(function(X){X.stopPropagation()});if(V.words.length>0&&n.length>0&&(s=="all"||s=="bottom")){h.append("<h4>"+n+"</h4>");T=true}var S=[];jQuery.each(V.words,function(Y,ab){if((s=="all"||s=="bottom")){if(ab.overlayImage!=undefined){h.append('<img class="unibox-vis" src="'+o+ab.overlayImage+'" style="background-image: url(\''+o+ab.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(ab.image!=undefined){h.append('<img class="unibox-vis" src="'+o+ab.image+'">')}}}var aa=e.find("#unibox-invisible");aa.html(W.replace(new RegExp(ab.name,"gi"),"<span>"+ab.name+"</span>"));if((s=="all"||s=="top")&&jQuery.inArray(ab.image,N)==-1){var Z=e.find("#unibox-invisible span")[0];if(Z!=undefined&&ab.name.length>0&&ab.image!=undefined){var X=jQuery(Z).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+o+ab.image+'" alt="'+ab.name+'"></div>');visImage.css("left",j().left+X-10);visImage.css("top",j().top-t.outerHeight()+F);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);S.push(ab.image)}}else{if(jQuery.inArray(ab.image,N)>-1){S.push(ab.image)}}});N=S;jQuery("img").error(function(){if(H){jQuery(this).attr("src",H)}else{jQuery(this).hide()}});g();if(T){if(h.is(":visible")){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)}else{h.slideDown(r,function(){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)})}}else{K()}}function j(){return{left:t.offset().left-e.offset().left,top:t.offset().top-e.offset().top+t.outerHeight()}}function E(){var S=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var R=0;R<S.length;R++){if(jQuery.inArray(S[R].replace(o,""),N)==-1){e.find('.unibox-ivf:has(img[src*="'+S[R]+'"])').remove()}}}function p(){N=[];e.find(".unibox-ivf").remove()}function J(R){if(t.val().length<=1){p()}if(M!=undefined){M.call(this,t.val())}if(R.keyCode!=37&&R.keyCode!=38&&R.keyCode!=39&&R.keyCode!=40&&R.keyCode!=13){E();return}if(R.keyCode==38&&A>0){A--}else{if(R.keyCode==40){A++}else{if(R.keyCode==38&&A<=0){A=((A!=-1)?A-1:A)+k.length}else{if((R.keyCode==37||R.keyCode==39)&&A>-1){A=A%k.length;var V=jQuery(k[A]);var Y=V.closest(".unibox-suggest-cluster");var T;if(R.keyCode==37){T=Y.prev()}else{if(R.keyCode==39){T=Y.next()}}if(T.hasClass("unibox-suggest-cluster")){var Z=T.find("div.unibox-selectable")[0];A=jQuery("#unibox-suggest-box div.unibox-selectable").index(Z)}}}}}if(k.length>0&&A>-1){A=A%k.length;jQuery(k).removeClass("active");var W=jQuery(k[A]);W.addClass("active")}if(R.keyCode==13){if(u!=undefined){var U=t.val();var S=undefined;if(A!=-1){U=jQuery(e.find(".unibox-selectable.active")[0]).text();t.val(U);try{S=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(X){}if(u!=undefined){u.call(this,U,S)}}}else{if(A!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(A>-1){R.preventDefault()}}function D(R){if(B==18){B=R.keyCode;return}B=R.keyCode;if(((R.keyCode==37||R.keyCode==39)&&A>-1)||R.keyCode==38||R.keyCode==40||R.keyCode==13||R.keyCode==9){return}var S=t.val();if(B==46&&S.length==0){p()}if(S.length>=l){z=S;jQuery.ajax({usedQuery:S,url:f+encodeURIComponent(S),dataType:"json",success:function(T){if(this.usedQuery==z){Q(T)}}})}}function g(){var S=jQuery("#unibox-suggest-box");var R=S.css("border-width").replace("px","");S.css("min-width",t.outerWidth()-2*R);if(v==undefined){S.css("max-width",t.outerWidth()-2*R)}else{S.css("max-width",v-2*R)}S.css("left",j().left);S.css("top",j().top)}return{updateSuggestUrl:function(R){f=R},hideSuggestBox:function(){K()},setIvfImagePath:function(R){o=R;if(o.charAt(o.length-1)!="/"){o+="/"}},changeInstantVisualFeedbackState:function(R){s=R},render:function(){g()},getText:function(){return t.val()},init:function(ae,ag){t=ae;e=ag.searchBoxContainer;O=ag.highlight;q=ag.extraHtml;f=ag.suggestUrl;o=ag.ivfImagePath;F=ag.ivfImageOffset;H=ag.missingErrorImage;a=ag.throttleTime;r=ag.animationSpeed;l=ag.minChars;w=ag.enterCallback;u=ag.enterCallbackResult;M=ag.typeCallback;d=ag.focusCallback;c=ag.blurCallback;C=ag.placeholder;s=ag.instantVisualFeedback;n=ag.queryVisualizationHeadline;b=ag.showDeleteAllButton;L=ag.suggestOrder;i=ag.suggestSelectionOrder;v=ag.maxWidth;t.attr("autocomplete","off");h=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(h);var ac=e.css("position");if(ac!="absolute"){e.css("position","relative")}var X=h.css("border-width").replace("px","");h.css("min-width",t.outerWidth()-2*X);h.css("max-width",ag.maxWidth-2*X);t.keydown(J);t.keydown(G(D,a));t.keyup(K);t.focusout(function(){y();if(c!=undefined){c.call(this,jQuery(this).val())}});t.focus(function(ah){ah.stopPropagation();if(jQuery(this).val().length>0){D({keyCode:-1})}if(d!=undefined){d.call(this,jQuery(this).val())}});h.mouseenter(function(){h.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(){y()});t.click(function(ah){ah.stopPropagation()});h.click(function(ah){ah.stopPropagation()});var S=t.attr("placeholder");C=S&&S.length>0?S:C;if(C&&C.length>0){var Z=document.createElement("input");if(!("placeholder" in Z)){t.focus(function(){var ah=jQuery(this).attr("placeholder");if((ah)&&(ah.length>0)&&(ah!="")&&jQuery(this).val()==ah){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var ah=jQuery(this).attr("placeholder");if((ah)&&(ah.length>0)&&(ah!="")&&(jQuery(this).val()==""||jQuery(this).val()==ah)){jQuery(this).val(ah).addClass("hasPlaceholder")}});t.val(C)}t.attr("placeholder",C)}var af=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(af);if(b){var ad=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(ad);jQuery(ad).mousedown(function(ah){(ah||window.event).stopPropagation();t.val("");t.focus();return false});t.focus(function(){if(t.val().length>0){ad.show()}else{ad.hide()}}).blur(function(){ad.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(ad).show()}});var ab=parseInt(t.css("paddingTop").replace("px","").trim());var aa=t.outerHeight();var Y=parseInt(t.css("borderTopWidth").replace("px","").trim());var V=t.css("boxShadow").match(/\d{1,3}px/g);var U=(V&&V.length>2)?parseInt(V[2].replace("px","").trim()):0;ad.height(aa-(2*Y)-U-ab);var R=parseInt(t.css("paddingRight").replace("px","").trim());R=(R>25)?R:25;t.css("paddingRight",R);var W=Y+U+(t.offset().top-t.parent().offset().top-t.parent().scrollTop());var T=Math.abs(t[0].getBoundingClientRect().left-t.parent()[0].getBoundingClientRect().left)+t.outerWidth()-ad.outerWidth()-Y-R;ad.css("top",W);ad.css("left",T)}if(s=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));