var UniBox=function(){var B=-1;var u;var e;var i;var f="";var p="";var H=-80;var J;var a;var l=[];var Q=true;var r;var g;var s=300;var o="";var m=2;var x;var v;var O;var d;var c;var E;var P=[];var t="all";var C=-1;var A="";var b=false;var N=[];var j=[];var w=undefined;var S=undefined;var T=undefined;var D=undefined;var U=true;var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function M(W){W=W||window.event;if(W!==undefined){var X=W.keyCode||W.which;var Y=u.val();if(X==27||X==13||X==9||Y.length<m){z(W);if(X==13&&x!==undefined&&B==-1){x.call(this,Y)}B=-1}}else{z(W);B=-1}}function z(W){if(c!==undefined){c.call(this,W,i.val())}i.removeClass("uniboxActive");i.slideUp(s);q()}function I(X,W){var Y=null;return function(){var aa=this,Z=arguments;clearTimeout(Y);Y=window.setTimeout(function(){X.apply(aa,Z)},W||50)}}function K(X,W){if(!Q){return X}var ad=W.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/[^a-zA-Z0-9äöüÄÖÜß]/g," ").split(" ");ad.sort(function(af,ae){return ae.length-af.length});var ac={};jQuery.each(ad,function(ae,aj){if(aj.length<1){return}var ai=X.match(new RegExp("(("+aj+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(ai!=null){for(var ah=0;ah<ai.length;ah++){var ag=ai[ah];var af=ag.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");X=X.replace(new RegExp("("+af+")(?!#<##|-\\d+#<##)","g"),"##>#"+ae+"-"+ah+"#<##");ac["##>#"+ae+"-"+ah+"#<##"]='<span class="unibox-highlight">'+ag+"</span>"}}});var aa=Object.keys(ac).reverse();for(var Y=0;Y<aa.length;Y++){var ab=aa[Y];var Z=ac[ab];X=X.replace(new RegExp(ab,"gi"),Z)}return X}function R(W){return W.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function y(W){return String(W).replace(/[&<>"'\/]/g,function(X){return n[X]})}function V(ab){if(C==13){M();return}var X=u.val();var ac=y(X);i.html("");var Z=false;var W=false;var aa=Object.keys(ab.suggests);if(N&&N.length>0){aa=N;jQuery.each(Object.keys(ab.suggests),function(ad,ae){if(jQuery.inArray(ae,aa)<0){aa.push(ae)}})}jQuery.each(aa,function(ad,ag){var af=ab.suggests[ag];if(!af||af.length==0){return true}var ae=0;jQuery.each(aa,function(aj,al){var ak=ab.suggests[al];if(!ak||ag===al||ak.length==0){return true}ae+=ak.length});var ai=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+R(ag)+" "+("unibox-"+af.length+"-entries")+" "+(ae==0?"unibox-single-suggestion-block":"")+'"></div>');if(ag.replace(/_/,"").length>0&&af.length>0){var ah=jQuery("<h4>"+ag+"</h4>");ai.append(ah)}jQuery.each(af,function(at,aq){var an='<div class="unibox-selectable">';if(aq.image!=undefined){var av=aq.image.length===0&&J?J:aq.image.length===0||aq.image.indexOf("/")===0||aq.image.indexOf("http")===0?aq.image:p+aq.image;an+='<div class="unibox-selectable-img-container"><img src="'+av+'"/></div>'}if(aq.link!=undefined&&aq.link!=""){an+='<a class="uniboxSearchContent" href="'+aq.link+'">';an+=K(aq.name,ac);an+="</a>"}else{an+='<span class="uniboxSearchContent">'+K(aq.name,ac)+"</span>"}if(r!=undefined){var ar=r.match(/##(.*?)##/gi);var am=r;var al=false;for(var ao=0;ao<ar.length;ao++){var ap=ar[ao];if(ap===undefined||ap.length==0){continue}var ak=ap.replace(/#/g,"");var aj=aq[ak];if(aj==undefined){al=true;continue}var aw=new RegExp(ap,"g");am=am.replace(aw,aj)}if(!al){an+='<div class="unibox-extra">'+am+"</div>"}}an+='<div class="unibox-ca"></div></div>';if(g!==undefined){an=g.call(this,an,ag,at,aq)}var au=jQuery(an);ai.append(au);Z=true});i.append(ai)});l=e.find(".unibox-selectable");if(j&&j.length>0){l=[];jQuery.each(j,function(ad,ae){l=l.concat(e.find(".unibox-suggest-"+R(ae)+":first .unibox-selectable").get())});jQuery.each(jQuery.grep(Object.keys(ab.suggests),function(ad){if(j.indexOf(ad)<0){return true}}),function(ad,ae){l=l.concat(e.find(".unibox-suggest-"+R(ae)+":first .unibox-selectable").get())})}B=-1;jQuery(l).mousedown(function(){var ae=jQuery(this).find(".uniboxSearchContent:first").text();u.val(ae);var ad=undefined;try{ad=jQuery(this).find("a:first").attr("href")}catch(af){}if(v!=undefined){v.call(this,ae,ad)}M()});e.find(".unibox-selectable .unibox-extra").click(function(ad){ad.stopPropagation()});if(ab.words!=undefined){if(ab.words.length>0&&o.length>0&&(t=="all"||t=="bottom")){i.append("<h4>"+o+"</h4>");Z=true}var Y=[];jQuery.each(ab.words,function(ae,ah){if((t=="all"||t=="bottom")){if(ah.overlayImage!=undefined){i.append('<img class="unibox-vis" src="'+p+ah.overlayImage+'" style="background-image: url(\''+p+ah.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(ah.image!=undefined){i.append('<img class="unibox-vis" src="'+p+ah.image+'">')}}}var ag=e.find("#unibox-invisible");ag.css("padding",u.css("padding"));ag.html(ac.replace(new RegExp(ah.name,"gi"),"<span>"+ah.name+"</span>"));if((t=="all"||t=="top")&&jQuery.inArray(ah.image,P)==-1){var af=e.find("#unibox-invisible span")[0];if(af!=undefined&&ah.name.length>0&&ah.image!=undefined){var ad=jQuery(af).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+p+ah.image+'" alt="'+ah.name+'"></div>');visImage.css("left",k().left+ad-10);visImage.css("top",k().top-u.outerHeight()+H);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);Y.push(ah.image)}}else{if(jQuery.inArray(ah.image,P)>-1){Y.push(ah.image)}}});P=Y}jQuery("img").on("error",function(){if(J){jQuery(this).attr("src",J)}else{jQuery(this).hide()}});h();if(S!=undefined&&!Z){Z=true;W=true;i.append(S)}if(Z){if(i.is(":visible")){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)}else{i.slideDown(s,function(){i.addClass("uniboxActive");i.css("left",k().left);i.css("top",k().top)})}if(D&&!W){i.append(D)}}else{M()}}function k(){return{left:u.offset().left-e.offset().left,top:u.offset().top-e.offset().top+u.outerHeight()}}function G(){var X=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var W=0;W<X.length;W++){if(jQuery.inArray(X[W].replace(p,""),P)==-1){e.find('.unibox-ivf:has(img[src*="'+X[W]+'"])').remove()}}}function q(){P=[];e.find(".unibox-ivf").remove()}function L(W){if(u.val().length<=1){q()}if(O!=undefined){O.call(this,W,u.val())}if(W.keyCode!=37&&W.keyCode!=38&&W.keyCode!=39&&W.keyCode!=40&&W.keyCode!=13){G();return}if(W.keyCode==38&&B>0){B--}else{if(W.keyCode==40){B++}else{if(W.keyCode==38&&B<=0){B=((B!=-1)?B-1:B)+l.length}else{if((W.keyCode==37||W.keyCode==39)&&B>-1){B=B%l.length;var aa=jQuery(l[B]);var ad=aa.closest(".unibox-suggest-cluster");var Y;if(W.keyCode==37){Y=ad.prev()}else{if(W.keyCode==39){Y=ad.next()}}if(Y.hasClass("unibox-suggest-cluster")){var ae=Y.find("div.unibox-selectable")[0];B=jQuery("#unibox-suggest-box div.unibox-selectable").index(ae)}}}}}if(l.length>0&&B>-1){B=B%l.length;jQuery(l).removeClass("active");var ab=jQuery(l[B]);ab.addClass("active")}if(W.keyCode==13){W.preventDefault();W.stopPropagation();if(v!=undefined){var Z=u.val();var X=undefined;if(B!=-1){Z=e.find(".unibox-selectable.active .uniboxSearchContent:first").text();u.val(Z);try{X=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(ac){}if(v!=undefined){v.call(this,Z,X)}}}else{if(B!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(B>-1){W.preventDefault()}}function F(W){if(C==18){C=W.keyCode;return}C=W.keyCode;if(((W.keyCode==37||W.keyCode==39)&&B>-1)||W.keyCode==38||W.keyCode==40||W.keyCode==13||W.keyCode==9){return}var X=u.val();if(C==46&&X.length==0){q()}if(X.length>=m){A=X;jQuery.ajax({usedQuery:X,url:f+encodeURIComponent(X),dataType:"json",success:function(Y){if(this.usedQuery==A){V(Y)}}})}}function h(){var X=jQuery("#unibox-suggest-box");var W=X.css("border-width").replace("px","");X.css("min-width",u.outerWidth()-2*W);if(w==undefined){X.css("max-width",u.outerWidth()-2*W)}else{X.css("max-width",w-2*W)}X.css("left",k().left);X.css("top",k().top)}return{updateSuggests:function(W){V(W)},updateSuggestUrl:function(W){f=W},hideSuggestBox:function(){M()},setIvfImagePath:function(W){p=W;if(p.charAt(p.length-1)!="/"){p+="/"}},changeInstantVisualFeedbackState:function(W){t=W},render:function(){h()},getText:function(){return u.val()},init:function(aj,al){u=aj;e=al.searchBoxContainer;Q=al.highlight;r=al.extraHtml;g=al.lineCallback;f=al.suggestUrl;p=al.ivfImagePath;H=al.ivfImageOffset;J=al.missingErrorImage;a=al.throttleTime;s=al.animationSpeed;m=al.minChars;x=al.enterCallback;v=al.enterCallbackResult;O=al.typeCallback;d=al.focusCallback;c=al.blurCallback;E=al.placeholder;t=al.instantVisualFeedback;o=al.queryVisualizationHeadline;b=al.showDeleteAllButton;N=al.suggestOrder;j=al.suggestSelectionOrder;w=al.maxWidth;S=al.noSuggests;T=al.emptyQuerySuggests;D=al.showMoreResults;U=al.disableEventPropagationHtml;u.attr("autocomplete","off");i=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(i);var ah=e.css("position");if(ah!="absolute"){e.css("position","relative")}var ac=i.css("border-width").replace("px","");i.css("min-width",u.outerWidth()-2*ac);i.css("max-width",al.maxWidth-2*ac);u.keydown(L);u.keydown(I(F,a));u.keyup(M);u.focus(function(am){am=am||window.event;am.stopPropagation();if(jQuery(this).val().length>0){F({keyCode:-1})}else{if(T!=undefined){V(T)}}if(d!==undefined){d.call(this,am,jQuery(this).val())}});i.mouseenter(function(){i.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(am){if(i.hasClass("uniboxActive")){z(am)}});u.keydown(function(an){an=an||window.event;var am=an.keyCode||an.which;if(am==9){z(an)}});u.focusout(function(am){am=am||window.event;setTimeout(function(){if(jQuery(document.activeElement).parents("#unibox-suggest-box").length===0){z(am)}},10)});if(U){u.click(function(am){am.stopPropagation()});i.click(function(am){am.stopPropagation()})}var X=u.attr("placeholder");E=X&&X.length>0?X:E;if(E&&E.length>0){var ae=document.createElement("input");if(!("placeholder" in ae)){u.focus(function(){var am=jQuery(this).attr("placeholder");if((am)&&(am.length>0)&&(am!="")&&jQuery(this).val()==am){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var am=jQuery(this).attr("placeholder");if((am)&&(am.length>0)&&(am!="")&&(jQuery(this).val()==""||jQuery(this).val()==am)){jQuery(this).val(am).addClass("hasPlaceholder")}});u.val(E)}u.attr("placeholder",E)}var ak=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(ak);if(b){var ai=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(ai);jQuery(ai).mousedown(function(am){(am||window.event).stopPropagation();u.val("");u.focus();return false});u.focus(function(){if(u.val().length>0){ai.show()}else{ai.hide()}}).blur(function(){ai.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(ai).show()}});var ag=parseInt(u.css("paddingTop").replace("px","").trim());var af=u.outerHeight();var ad=parseInt(u.css("borderTopWidth").replace("px","").trim());var aa=u.css("boxShadow").match(/\d{1,3}px/g);var Z=(aa&&aa.length>2)?parseInt(aa[2].replace("px","").trim()):0;ai.height(af-(2*ad)-Z-ag);var W=parseInt(u.css("paddingRight").replace("px","").trim());W=(W>25)?W:25;u.css("paddingRight",W);var ab=ad+Z+(u.offset().top-u.parent().offset().top-u.parent().scrollTop());var Y=Math.abs(u[0].getBoundingClientRect().left-u.parent()[0].getBoundingClientRect().left)+u.outerWidth()-ai.outerWidth()-ad-W;ai.css("top",ab);ai.css("left",Y)}if(t=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,lineCallback:undefined,noSuggests:undefined,emptyQuerySuggests:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));